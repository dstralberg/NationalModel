library(plotrix) #for thigmophobe.labels (not used)
library(maptools) #for pointLabel 

clim <- read.csv("P:/Manuscripts/TremblayEtAl/AlbertaLANDIS/SpeciesVulnerabilityCompareTremblayCadieux.csv")
clim$logAB2080 <- log10(clim$AB2080)
clim$logLANDIS2080 <- log10(clim$LANDIS2080)
clim$logAB2050 <- log10(clim$AB2050)
clim$logLANDIS2050 <- log10(clim$LANDIS2050)
#clim <- clim[1:67,]

niche <- read.csv(file="G:/Boreal/DensityModelsV6/tables/_nichestats.csv")
lhist2 <- read.csv("E:/BAM/BAMData/lhist2_mod.csv")
lhist2$AOUCODE_DUC <- gsub("YEWA","YWAR",lhist2$AOUCODE_DUC)
lhist2$speciesCode <- lhist2$AOU*10

trend <- read.csv(file="E:/BAM/BAMData/BBS/CanadaTrends2017.csv")
trend <- merge(trend,lhist2[,c(5,6,12,15,92)],by.x="speciesID",by.y="speciesCode")
trendC <- trend[trend$region == "Alberta-BCR6",]
trendC <- trendC[trendC$timeFrame == "long-term",c(2,8,28,29,30,31)]
trendC$AOUCODE_DUC <- gsub("YEWA","YWAR",trendC$AOUCODE_DUC)

climtrend <- merge(trendC, clim[,c(1:2,17:25)], by.y="Code",by.x="AOUCODE_DUC")
names(climtrend)[3] <- "Trend"
climtrend <- na.omit(climtrend)

climtrend$trendprop <- 1 + climtrend$Trend/100
climtrend$logtrendprop <- log10(climtrend$trendprop)

decid <- list("deciduous <30yr", "deciduous 60-80yr", "deciduous 30-60yr", "deciduous >80yr")
old <- list("coniferous >80yr", "coniferous 60-80yr", "mixedwood >80yr", "mixedwood 60-80yr")
young <- list("coniferous <30yr", "coniferous 30-60yr", "mixedwood <30yr", "mixedwood 30-60yr")

ROOT2 <- "F:/GoogleDrive/BAM.SharedDrive/RshProjs/PopnStatus/NationalModels/Feb2020/"
BCR<-60
b<-1
BAMtrend <- read.csv(paste0(ROOT2,"out/","parts/_BCR",BCR,"_bs",b,"AB_1996-2016_trend.csv"))

climtrend <- merge(climtrend, BAMtrend, by.x="AOUCODE_DUC", by.y="SPP")
#climtrend <- climtrend[climtrend$AgeCover != "treeless",]

treeless <- climtrend[climtrend$AgeCover == "treeless",]
deciduous <- climtrend[climtrend$AgeCover %in% decid,]
oldmixedconif <- climtrend[climtrend$AgeCover %in% old,]
youngmixedconif <- climtrend[climtrend$AgeCover %in% young,]

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BAMTrendsvsBBSTrends2017_AB.pdf")
#par(cex=0.8)
reg <- lm(climtrend$trend ~ climtrend$logtrendprop)
plot(climtrend$logAB2080,climtrend$trend,  ylim=c(-0.01,0.01),xlim=c(-0.05,0.05), xlab="Alberta BBS trend 1970-2017 (log scale)", ylab="Alberta BAM trend 1996-2016 (log scale)")
rect(-1, -1, 0, 0, col = "tomato", border=NA)
rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
rect(0, -1, 1, 0, col = "khaki", border=NA)
points(oldmixedconif$logtrendprop, oldmixedconif$trend, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(youngmixedconif$logtrendprop, youngmixedconif$trend, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(deciduous$logtrendprop, deciduous$trend, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(treeless$logtrendprop, treeless$trend, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
#error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
abline(v=0)
abline(h=0)
abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
pointLabel(climtrend$logtrendprop, climtrend$trend, labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BBSTrends2017vsClimProj_AB2050_ageclass.pdf")
#par(cex=0.8)
reg <- lm(climtrend$logtrendprop ~ climtrend$logAB2080)
plot(climtrend$logAB2050, climtrend$logtrendprop,  ylim=c(-0.03,0.03),xlim=c(-0.9,0.9), ylab="Alberta BBS trend 1970-2017 (log scale)", xlab="Bioclimatic model projection 2080s (log scale)")
rect(-1, -1, 0, 0, col = "tomato", border=NA)
rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
rect(0, -1, 1, 0, col = "khaki", border=NA)
points(oldmixedconif$logAB2050, oldmixedconif$logtrendprop, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(youngmixedconif$logAB2050, youngmixedconif$logtrendprop, pch=21, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points( deciduous$logAB2050, deciduous$logtrendprop,pch=24, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(treeless$logAB2050, treeless$logtrendprop, pch=24, bg="white", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
#error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
abline(v=0)
abline(h=0)
abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
pointLabel(climtrend$logAB2050,climtrend$logtrendprop,  labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()
	
pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BBSTrend2017svsClimProj_AB2080_ageclass.pdf")
#par(cex=0.8)
  reg <- lm(climtrend$logtrendprop ~ climtrend$logAB2080)
  plot(climtrend$logAB2080,climtrend$logtrendprop,  ylim=c(-0.03,0.03),xlim=c(-0.9,0.9), xlab="Bioclimatic model projection 2080s (log scale)", ylab="Alberta BBS trend 1970-2017 (log scale)")
  rect(-1, -1, 0, 0, col = "tomato", border=NA)
  rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
  rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
  rect(0, -1, 1, 0, col = "khaki", border=NA)
  points(oldmixedconif$logAB2080, oldmixedconif$logtrendprop, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  points(youngmixedconif$logAB2080, youngmixedconif$logtrendprop, pch=21, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  points(deciduous$logAB2080, deciduous$logtrendprop, pch=24, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  points(treeless$logAB2080, treeless$logtrendprop, pch=24, bg="white", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  #error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
  abline(v=0)
  abline(h=0)
  abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
  pointLabel(climtrend$logAB2080, climtrend$logtrendprop, labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BBSTrends2017vsClimProj_AB2080_ageclass_flipped.pdf")
#par(cex=0.8)
reg <- lm(climtrend$logtrendprop ~ climtrend$logAB2080)
plot(climtrend$logAB2080,climtrend$logtrendprop,  ylim=c(0.03,-0.03),xlim=c(0.9,-0.9), xlab="Bioclimatic model projection 2080s (log scale)", ylab="Alberta BBS trend 1970-2017 (log scale)")
rect(-1, -1, 0, 0, col = "tomato", border=NA)
rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
rect(0, -1, 1, 0, col = "khaki", border=NA)
points(oldmixedconif$logAB2080, oldmixedconif$logtrendprop, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(youngmixedconif$logAB2080, youngmixedconif$logtrendprop, pch=21, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(deciduous$logAB2080, deciduous$logtrendprop, pch=24, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(treeless$logAB2080, treeless$logtrendprop, pch=24, bg="white", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
#error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
abline(v=0)
abline(h=0)
abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
pointLabel(climtrend$logAB2080, climtrend$logtrendprop, labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BBSTrends2017vsLANDISProj_AB2080_ageclass.pdf")
#par(cex=0.8)
  reg <- lm(climtrend$logtrendprop ~ climtrend$logLANDIS2080)
  plot(climtrend$logLANDIS2080, climtrend$logtrendprop, xlim=c(-0.5,0.5),ylim=c(-0.03,0.03), xlab="Alberta BBS trend 1970-2017 (log scale)", ylab="Forest landscape simulation 2080s (log scale)")
  rect(-1, -1, 0, 0, col = "tomato", border=NA)
  rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
  rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
  rect(0, -1, 1, 0, col = "khaki", border=NA)
  points( oldmixedconif$logLANDIS2080,oldmixedconif$logtrendprop, pch=21, bg="black", xlim=c(-0.5, 0.5),ylim=c(-0.9,0.9),cex=1)
  points( youngmixedconif$logLANDIS2080,youngmixedconif$logtrendprop, pch=21, bg="light gray", xlim=c(-0.5, 0.5),ylim=c(-0.9,0.9),cex=1)
  points( deciduous$logLANDIS2080, deciduous$logtrendprop,pch=24, bg="light gray", xlim=c(-0.5, 0.5),ylim=c(-0.9,0.9),cex=1)
  points(treeless$logLANDIS2080,treeless$logtrendprop,  pch=24, bg="white", xlim=c(-0.5, 0.5),ylim=c(-0.9,0.9),cex=1)
  #error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
  abline(v=0)
  abline(h=0)
  abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
  pointLabel(climtrend$logLANDIS2080, climtrend$logtrendprop, labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BBSTrends2017vsLANDISProj_AB2050_ageclass.pdf")
#par(cex=0.8)
reg <- lm(climtrend$logtrendprop ~ climtrend$logLANDIS2050)
plot(climtrend$logLANDIS2050, climtrend$logtrendprop, xlim=c(-0.3,0.3),ylim=c(-0.03,0.03), ylab="Alberta BBS trend 1970-2017 (log scale)", xlab="Forest landscape simulation 2050s (log scale)")
rect(-1, -1, 0, 0, col = "tomato", border=NA)
rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
rect(0, -1, 1, 0, col = "khaki", border=NA)
points(oldmixedconif$logLANDIS2050, oldmixedconif$logtrendprop, pch=21, bg="black", xlim=c(-0.5, 0.5),ylim=c(-0.9,0.9),cex=1)
points( youngmixedconif$logLANDIS2050, youngmixedconif$logtrendprop,pch=21, bg="light gray", xlim=c(-0.5, 0.5),ylim=c(-0.9,0.9),cex=1)
points( deciduous$logLANDIS2050,deciduous$logtrendprop, pch=24, bg="light gray", xlim=c(-0.5, 0.5),ylim=c(-0.9,0.9),cex=1)
points( treeless$logLANDIS2050,treeless$logtrendprop, pch=24, bg="white", xlim=c(-0.5, 0.5),ylim=c(-0.9,0.9),cex=1)
#error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
abline(v=0)
abline(h=0)
abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
pointLabel( climtrend$logLANDIS2050, climtrend$logtrendprop,labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BAMTrendsvsClimProj_AB2080_ageclass.pdf")
  #par(cex=0.8)
  reg <- lm(climtrend$trend ~ climtrend$logAB2080)
  plot(climtrend$logAB2080,climtrend$trend,  ylim=c(-0.01,0.01),xlim=c(-0.9,0.9), xlab="Bioclimatic model projection 2080s (log scale)", ylab="Alberta BAM trend 1996-2016 (log scale)")
  rect(-1, -1, 0, 0, col = "tomato", border=NA)
  rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
  rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
  rect(0, -1, 1, 0, col = "khaki", border=NA)
  points(oldmixedconif$logAB2080, oldmixedconif$trend, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  points(youngmixedconif$logAB2080, youngmixedconif$trend, pch=21, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  points(deciduous$logAB2080, deciduous$trend, pch=24, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  points(treeless$logAB2080, treeless$trend, pch=24, bg="white", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  #error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
  abline(v=0)
  abline(h=0)
  abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
  pointLabel(climtrend$logAB2080, climtrend$trend, labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BAMTrendsvsClimProj_AB2050_ageclass.pdf")
#par(cex=0.8)
reg <- lm(climtrend$trend ~ climtrend$logAB2050)
plot(climtrend$logAB2050,climtrend$trend,  ylim=c(-0.01,0.01),xlim=c(-0.9,0.9), xlab="Bioclimatic model projection 2050s (log scale)", ylab="Alberta BAM trend 1996-2016 (log scale)")
rect(-1, -1, 0, 0, col = "tomato", border=NA)
rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
rect(0, -1, 1, 0, col = "khaki", border=NA)
points(oldmixedconif$logAB2050, oldmixedconif$trend, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(youngmixedconif$logAB2050, youngmixedconif$trend, pch=21, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(deciduous$logAB2050, deciduous$trend, pch=24, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
points(treeless$logAB2050, treeless$trend, pch=24, bg="white", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
#error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
abline(v=0)
abline(h=0)
abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
pointLabel(climtrend$logAB2050, climtrend$trend, labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BAMTrendsvsClimProj_AB2080_ageclass_flipped.pdf")
  #par(cex=0.8)
  reg <- lm(climtrend$trend ~ climtrend$logAB2080)
  plot(climtrend$logAB2080,climtrend$trend,  ylim=c(0.01,-0.01),xlim=c(0.9,-0.9), xlab="Bioclimatic model projection 2080 (log scale)", ylab="Alberta BAM trend 1996-2016 (log scale)")
  rect(-1, -1, 0, 0, col = "tomato", border=NA)
  rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
  rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
  rect(0, -1, 1, 0, col = "khaki", border=NA)
  points(oldmixedconif$logAB2080, oldmixedconif$trend, pch=21, bg="black", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  points(youngmixedconif$logAB2080, youngmixedconif$trend, pch=21, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  points(deciduous$logAB2080, deciduous$trend, pch=24, bg="light gray", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  points(treeless$logAB2080, treeless$trend, pch=24, bg="white", ylim=c(-0.03, 0.03),xlim=c(-0.9,0.9),cex=1)
  #error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
  abline(v=0)
  abline(h=0)
  #abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
  pointLabel(climtrend$logAB2080, climtrend$trend, labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BAMTrendsvsLANDISProj_AB2080_ageclass.pdf")
  #par(cex=0.8)
  reg <- lm(climtrend$trend ~ climtrend$logLANDIS2080)
  plot(climtrend$logLANDIS2080,climtrend$trend,  xlim=c(-0.5,0.5),ylim=c(-0.01,0.01), ylab="Alberta BAM trend 1996-2016 (log scale)", xlab="Forest landscape simulation 2080s (log scale)")
  rect(-1, -1, 0, 0, col = "tomato", border=NA)
  rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
  rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
  rect(0, -1, 1, 0, col = "khaki", border=NA)
  points(oldmixedconif$logLANDIS2080,oldmixedconif$trend,  pch=21, bg="black", ylim=c(-0.01, 0.01),xlim=c(-0.9,0.9),cex=1)
  points(youngmixedconif$logLANDIS2080,youngmixedconif$trend,  pch=21, bg="light gray", ylim=c(-0.01, 0.01),xlim=c(-0.9,0.9),cex=1)
  points(deciduous$logLANDIS2080, deciduous$trend, pch=24, bg="light gray", ylim=c(-0.01, 0.01),xlim=c(-0.9,0.9),cex=1)
  points(treeless$logLANDIS2080,treeless$trend,  pch=24, bg="white", ylim=c(-0.01, 0.01),xlim=c(-0.9,0.9),cex=1)
  #error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
  abline(v=0)
  abline(h=0)
  abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
  pointLabel(climtrend$logLANDIS2080,climtrend$trend,  labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()

pdf("I:/My Drive/BAM.SharedDrive/RshProjs/PopnChange/Trends/TrendComparisons/BAMTrendsvsLANDISProj_AB2050.pdf")
#par(cex=0.8)
reg <- lm( climtrend$trend ~ climtrend$logLANDIS2050 )
plot(climtrend$trend,climtrend$logLANDIS2050,  xlim=c(-0.3,0.3),ylim=c(-0.01,0.01), ylab="Alberta BAM trend 1996-2016 (log scale)", xlab="Forest landscape simulation 2050s (log scale)")
rect(-1, -1, 0, 0, col = "tomato", border=NA)
rect(0, 0, 1, 1, col = "olivedrab1", border=NA)
rect(-1, 0, 0, 1, col = "lightsalmon", border=NA)
rect(0, -1, 1, 0, col = "khaki", border=NA)
points(oldmixedconif$logLANDIS2050, oldmixedconif$trend, pch=21, bg="black", ylim=c(-0.01, 0.01),xlim=c(-0.9,0.9),cex=1)
points(youngmixedconif$logLANDIS2050,youngmixedconif$trend, pch=21, bg="black", ylim=c(-0.01, 0.01),xlim=c(-0.9,0.9),cex=1)
points( deciduous$logLANDIS2050, deciduous$trend,pch=21, bg="black", ylim=c(-0.01, 0.01),xlim=c(-0.9,0.9),cex=1)
points(treeless$logLANDIS2050,treeless$trend,  pch=21, bg="black", ylim=c(-0.01, 0.01),xlim=c(-0.9,0.9),cex=1)
#error.crosses(x, y, labels = NULL, pos = NULL, arrow.len = 0.2, ...)
abline(v=0)
abline(h=0)
abline(a=reg$coefficients[1],b=reg$coefficients[2],lty=3)
pointLabel( climtrend$logLANDIS2050,climtrend$trend, labels=as.character(climtrend$AOUCODE_DUC), allowSmallOverlap=FALSE, cex=0.8)
dev.off()